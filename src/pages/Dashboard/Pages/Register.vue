<template>
    <div class="row">
      <div class="col-lg-6 m-auto">
        <card class="card-signup text-center" no-footer-line>

          <template slot="header">
            <h4 class="card-title">Registrar</h4>
            <!-- <div class="social">
              <button class="btn btn-icon btn-round btn-twitter">
                <i class="fa fa-twitter"></i>
              </button>
              <button class="btn btn-icon btn-round btn-dribbble">
                <i class="fa fa-dribbble"></i>
              </button>
              <button class="btn btn-icon btn-round btn-facebook">
                <i class="fa fa-facebook"> </i>
              </button>
              <h5 class="card-description"> or be classical </h5>
            </div> -->
          </template>

          <form @submit.prevent="signUp()">

            <fg-input placeholder="Nombre"
                      addon-left-icon="now-ui-icons users_circle-08"
                      v-model="createUser.nombre">
            </fg-input>

            <fg-input placeholder="Apellido"
                      addon-left-icon="now-ui-icons users_circle-08"
                      v-model="createUser.apellido">
            </fg-input>

            <fg-input placeholder="Correo"
                      addon-left-icon="now-ui-icons users_circle-08"
                      v-model="createUser.email">
            </fg-input>

            <fg-input placeholder="Contrase単a"
                      type="password"
                      addon-left-icon="now-ui-icons text_caps-small"
                      v-model="createUser.password">
            </fg-input>

            <fg-input placeholder="Reeingresa la contrase単a"
                      type="password"
                      addon-left-icon="now-ui-icons text_caps-small"
                      v-model="createUser.repitPassword">
            </fg-input>

            <select name="" id="" v-model="createUser.perfil">
              <option value="seleccione">Seleccione un perfil</option>
              <option value="user">Usuario normal</option>
              <option value="admin">Administrador</option>
            </select>

            <!-- <checkbox class="text-left">
              I agree to the <a href="#something">terms and conditions</a>.
            </checkbox> -->
          </form>
          <n-button type="primary" round block @click.native="signUp">
            Registrar
          </n-button>

        </card>
      </div>
    </div>
</template>
<script>
import swal from 'sweetalert2'
import { Checkbox } from "src/components"
import { mapMutations } from "vuex"
import firebase from "firebase/app"
import "firebase/auth"
import { usuariosRef } from "src/firebase/firebase"
import { CREATE_USER_SUCCESS } from "src/constants/alerts"

export default {
  firebase: {
    usuariosRef
  },
  components: {
    Checkbox
  },
  data() {
    return {
      createUser: {
        nombre: null,
        apellido: null,
        email: null,
        password: null,
        repitPassword: null,
        perfil: "seleccione"
      }
    };
  },
  methods: {
    ...mapMutations([
      "setRegisterUser"
    ]),
    signUp() {
      if (this.createUser.password === this.createUser.repitPassword) {
        firebase.auth().createUserWithEmailAndPassword(
          this.createUser.email,
          this.createUser.password
        )
        .then(user => {
          // TODO - pasar funcionalidad a Vuex
          let response = usuariosRef.push(this.createUser)
          if (response) {
            swal({
              title: CREATE_USER_SUCCESS,
              buttonsStyling: false,
              confirmButtonClass: 'btn btn-success btn-fill',
              type: 'success'
            })
          } else alert("Hubo un problema al crear el usuario")
          // this.setRegisterUser(this.createUser)
        })
        .catch(err => {
          alert(err.message)
        })
      } else {
        swal({
          title: `Las contrase単as no coinciden`,
          text: 'Reeingrese la misma contrase単a para los dos campos',
          buttonsStyling: false,
          confirmButtonClass: 'btn btn-success btn-fill',
          type: 'error'
        })
      }
    }
  }
};
</script>
<style>
</style>
